<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Ramo - YHIBEL (texto más arriba, estrella en el medio)</title>
<style>
  :root{--accent:#ff4d6d;--soft:rgba(255,255,255,0.94)}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:#03050a;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--soft);overflow:hidden}
  .controls{position:fixed;top:14px;right:14px;z-index:1100}
  .controls button{background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:10px;margin-left:8px;font-weight:700;cursor:pointer;box-shadow:0 8px 26px rgba(0,0,0,0.45)}
  canvas.bg{position:fixed;inset:0;z-index:0;pointer-events:none}
  canvas.nameCanvas{position:fixed;inset:0;z-index:950;pointer-events:none}
  .aurora{position:fixed;inset:0;z-index:1;pointer-events:none;mix-blend-mode:screen;background:
    radial-gradient(circle at 10% 20%, rgba(86,240,190,0.06), transparent 6%),
    radial-gradient(circle at 85% 40%, rgba(180,120,255,0.05), transparent 8%);}
  .stage{position:relative;width:100%;height:100%;display:grid;place-items:center;z-index:6}
  .bouquet{width:760px;max-width:92vw;height:520px;position:relative;z-index:12;pointer-events:auto;display:block}
  .flowers{position:relative;width:100%;height:100%;z-index:15;pointer-events:auto}
  .flower{position:absolute;width:92px;height:140px;transform-origin:center bottom;cursor:pointer;user-select:none;z-index:20;pointer-events:auto;overflow:visible}
  .flower:hover{transform:translateY(-6px) scale(1.03);filter:drop-shadow(0 18px 34px rgba(0,0,0,0.45))}
  .flower svg{display:block;pointer-events:none}
  .tooltip{position:absolute;left:50%;transform:translateX(-50%);bottom:110%;background:linear-gradient(180deg,var(--accent),#ff7a8a);color:#fff;font-weight:800;padding:8px 12px;border-radius:12px;box-shadow:0 18px 40px rgba(0,0,0,0.45);white-space:nowrap;z-index:350;pointer-events:none}
  .subtitle{position:absolute;left:50%;transform:translateX(-50%);bottom:-48px;color:rgba(255,255,255,0.36);font-size:15px;z-index:12}
  .sparkle{position:absolute;font-size:16px;color:#fff7c2;z-index:1110;pointer-events:none;text-shadow:0 6px 18px rgba(255,190,60,0.18)}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1200;display:grid;place-items:center;opacity:0;pointer-events:none;transition:opacity .26s}
  .backdrop.show{opacity:1;pointer-events:auto}
  .card{width:min(720px,92%);background:linear-gradient(180deg,#0c0c10,#17161a);border-radius:14px;padding:28px;color:#fff;text-align:center;box-shadow:0 40px 120px rgba(0,0,0,0.6)}
  .emoji{position:fixed;font-size:30px;z-index:1190;pointer-events:none;animation:rise 1.6s forwards}
  @keyframes rise{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-140px) scale(1.08)}}
  .shooting-star{position:fixed;height:2px;background:linear-gradient(90deg, rgba(255,255,255,0.96), rgba(255,255,255,0));transform:rotate(-32deg);z-index:2}
  @media (max-width:520px){
    .flower{width:72px;height:110px}
    .subtitle{font-size:13px;bottom:-40px}
    .controls{top:8px;right:8px}
  }
</style>
</head>
<body>
  <div class="aurora" aria-hidden="true"></div>
  <div class="controls" role="group" aria-label="Controles">
    <button id="btnSorpresa">Sorpresa</button>
    <button id="btnReload" title="Recargar (F5)">Reiniciar</button>
  </div>

  <canvas id="starsCanvas" class="bg" aria-hidden="true"></canvas>
  <canvas id="nameCanvas" class="nameCanvas" aria-hidden="true"></canvas>

  <main class="stage" id="stage" role="main" aria-label="Ramo interactivo">
    <section class="bouquet" id="bouquet" aria-hidden="false">
      <div class="flowers" id="flowers" aria-live="polite"></div>
      <div class="subtitle">Haz click en una rosa para ver una frase bonita ✨</div>
    </section>
  </main>

  <div id="starContainer" style="position:fixed;inset:0;pointer-events:none;z-index:1110"></div>

  <div id="modalBackdrop" class="backdrop" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle">Para ti, mi reina</h2>
      <p id="modalMessage">Cada rosa en este pequeño corazón guarda un recuerdo, una risa y un suspiro pensado en ti. Gracias por ser mi compañía; te amo.</p>
      <div style="margin-top:12px"><button id="closeModal">Cerrar</button></div>
    </div>
  </div>

<script>
const DPR = Math.max(1, window.devicePixelRatio || 1);
const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) || window.innerWidth < 720;

const starsCanvas = document.getElementById('starsCanvas');
const starsCtx = starsCanvas.getContext('2d', { alpha: true });
const nameCanvas = document.getElementById('nameCanvas');
const nameCtx = nameCanvas.getContext('2d', { alpha: true });
const starContainer = document.getElementById('starContainer');

let stars = [], nameStars = [];
let rafId = null;
let last = performance.now();
let currentName = 'YHIBEL';

const bigStarState = { active:false, start:0, duration: isMobile?700:900 };

/* --- Position helpers --- */
/* user asked: text with stars higher -> set name center higher than before */
function getNameCenter(){
  const cx = Math.round(window.innerWidth / 2);
  // SUBIMOS el texto con estrellas un poco más
  const cy = Math.round(window.innerHeight * (isMobile ? 0.12 : 0.20)); // subido
  return { x: cx, y: cy };
}
/* user asked: estrella en el medio -> center of viewport */
function getStarCenter(){
  return { x: Math.round(window.innerWidth/2), y: Math.round(window.innerHeight/2) };
}

/* --- canvases fit --- */
function fitCanvases(){
  const w = window.innerWidth, h = window.innerHeight;
  [starsCanvas, nameCanvas].forEach(c => {
    c.width = Math.round(w * DPR);
    c.height = Math.round(h * DPR);
    c.style.width = w + 'px';
    c.style.height = h + 'px';
    const ctx = c.getContext('2d');
    ctx.setTransform(DPR,0,0,DPR,0,0);
  });
  initStars();
  createNameStars(currentName);
}

/* --- stars background --- */
function initStars(){
  stars = [];
  const area = window.innerWidth * window.innerHeight;
  const count = Math.max(80, Math.round(area / (isMobile ? 20000 : 12000)));
  for(let i=0;i<count;i++){
    stars.push({
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight,
      r: Math.random() * (isMobile ? 1.3 : 1.8) + 0.35,
      a: 0.18 + Math.random() * 0.9,
      p: Math.random() * Math.PI * 2,
      f: 0.002 + Math.random() * 0.01
    });
  }
}

/* --- big star draw (only when active) --- */
function easeOutBack(t){
  const c1 = 1.70158;
  const c3 = c1 + 1;
  return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);
}
function drawBigStarOnNameCanvas(progress){
  if(!nameCtx) return;
  const c = getStarCenter();
  const cx = c.x, cy = c.y;
  const baseOuter = Math.round(Math.min(window.innerWidth * 0.18, isMobile ? 90 : 170));
  const outerR = Math.max(28, Math.round(baseOuter * (0.4 + 0.7 * easeOutBack(progress))));
  const innerR = Math.round(outerR * 0.42);
  const alpha = 1 - Math.pow(Math.min(1, progress), 1.4);

  const grad = nameCtx.createRadialGradient(cx, cy, 0, cx, cy, outerR * 1.05);
  grad.addColorStop(0, `rgba(255,245,190,${0.95 * (0.6 + 0.4*alpha)})`);
  grad.addColorStop(0.45, `rgba(255,200,220,${0.9 * (0.6 + 0.4*alpha)})`);
  grad.addColorStop(1, `rgba(255,90,120,${0.06 * (0.6 + 0.4*alpha)})`);

  nameCtx.save();
  nameCtx.globalAlpha = 0.96 * (0.9 + 0.1 * (1-alpha));
  nameCtx.beginPath();
  const spikes = 5;
  const step = Math.PI / spikes;
  let rot = -Math.PI/2;
  for(let i=0;i<spikes;i++){
    const ox = cx + Math.cos(rot) * outerR;
    const oy = cy + Math.sin(rot) * outerR;
    if(i===0) nameCtx.moveTo(ox, oy); else nameCtx.lineTo(ox, oy);
    rot += step;
    const ix = cx + Math.cos(rot) * innerR;
    const iy = cy + Math.sin(rot) * innerR;
    nameCtx.lineTo(ix, iy);
    rot += step;
  }
  nameCtx.closePath();
  nameCtx.fillStyle = grad;
  nameCtx.fill();
  nameCtx.lineWidth = Math.max(1, Math.round(outerR * 0.04));
  nameCtx.strokeStyle = `rgba(255,200,140,${0.95 * (0.7 + 0.3*(1-alpha))})`;
  nameCtx.stroke();
  nameCtx.restore();
}

/* --- name-shaped stars generation (moved up) --- */
function createNameStars(name){
  nameStars = [];
  if(!name || name.trim().length===0) return;
  const off = document.createElement('canvas');
  off.width = Math.min(isMobile ? 800 : 1100, Math.max(480, Math.round(window.innerWidth * 0.6)));
  off.height = isMobile ? 160 : 260;
  const oc = off.getContext('2d');
  oc.clearRect(0,0,off.width,off.height);
  const fontSize = Math.round(off.width * 0.18);
  oc.lineWidth = Math.max(5, Math.round(fontSize * 0.11));
  oc.font = `bold ${fontSize}px Arial, sans-serif`;
  oc.textAlign = 'center'; oc.textBaseline = 'middle';
  oc.strokeStyle = '#ffffff'; oc.lineJoin='round'; oc.lineCap='round';
  const cx = off.width/2; const cy = off.height/2 + Math.round(fontSize*0.04);
  oc.strokeText(name, cx, cy);

  const step = Math.max(4, Math.round(Math.min(off.width, off.height) / (isMobile ? 70 : 110)));
  let img;
  try { img = oc.getImageData(0,0,off.width,off.height).data; }
  catch(e){
    // fallback
    const center = getNameCenter();
    for(let i=0;i<24;i++){
      nameStars.push({ x:center.x + (Math.random()*220 - 110), y:center.y + (Math.random()*36 - 18), r:1+Math.random()*1.4, baseA:0.6+Math.random()*0.4, speed:0.004+Math.random()*0.01, phase:Math.random()*Math.PI*2 });
    }
    return;
  }

  const screenCenterX = window.innerWidth/2;
  const screenCenterY = getNameCenter().y; // moved up
  const scale = Math.min((window.innerWidth * 0.72) / off.width, (window.innerHeight * 0.22) / off.height);
  const left = screenCenterX - (off.width * scale)/2;
  const top  = screenCenterY - (off.height * scale)/2;

  for(let y=0; y<off.height; y+=step){
    for(let x=0; x<off.width; x+=step){
      const idx = (y * off.width + x) * 4;
      const a = img[idx+3];
      if(a > 48){
        const sx = left + x * scale + (Math.random()*step - step/2) * 0.18;
        const sy = top  + y * scale + (Math.random()*step - step/2) * 0.18;
        const baseR = (0.9 + Math.random()*1.5) * Math.max(0.7, scale*0.95);
        const mobileR = baseR * (isMobile ? 0.72 : 1.0);
        nameStars.push({ x:sx, y:sy, r:mobileR, baseA:0.55+Math.random()*0.6, speed:0.004+Math.random()*0.012, phase:Math.random()*Math.PI*2 });
      }
    }
  }
  if(nameStars.length < 18){
    for(let i=0;i<28;i++){
      nameStars.push({ x:screenCenterX + (Math.random()*340 - 170), y:screenCenterY + (Math.random()*60 - 30), r:1.0+Math.random()*1.2, baseA:0.6+Math.random()*0.4, speed:0.005+Math.random()*0.01, phase:Math.random()*Math.PI*2 });
    }
  }
}

/* --- render loop --- */
function render(now){
  rafId = requestAnimationFrame(render);
  const dt = now - last; last = now;

  // background stars
  starsCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
  for(const s of stars){
    s.p += s.f * dt;
    const alpha = Math.max(0.05, Math.min(1, s.a * (0.6 + 0.4 * Math.sin(s.p))));
    const g = starsCtx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r * 6);
    g.addColorStop(0, `rgba(255,255,255,${alpha})`);
    g.addColorStop(0.6, `rgba(255,255,255,${alpha*0.12})`);
    g.addColorStop(1, 'rgba(255,255,255,0)');
    starsCtx.fillStyle = g;
    starsCtx.beginPath(); starsCtx.arc(s.x, s.y, s.r*3, 0, Math.PI*2); starsCtx.fill();
  }

  // name canvas
  nameCtx.clearRect(0,0,window.innerWidth,window.innerHeight);

  if(bigStarState.active){
    const progress = Math.min(1, (now - bigStarState.start) / bigStarState.duration);
    drawBigStarOnNameCanvas(progress);
    if(progress >= 1) bigStarState.active = false;
  }

  for(const ns of nameStars){
    ns.phase += ns.speed * dt;
    const flick = 0.6 + 0.4 * Math.sin(ns.phase);
    const alpha = Math.max(0.16, Math.min(1, ns.baseA * flick));
    const rad = Math.max(1.0, ns.r * (isMobile ? 1.08 : 1.45));
    const g2 = nameCtx.createRadialGradient(ns.x, ns.y, 0, ns.x, ns.y, rad*4);
    g2.addColorStop(0, `rgba(255,200,220,${alpha})`);
    g2.addColorStop(0.5, `rgba(255,110,140,${alpha*0.26})`);
    g2.addColorStop(1, 'rgba(255,90,120,0)');
    nameCtx.fillStyle = g2;
    nameCtx.beginPath(); nameCtx.arc(ns.x, ns.y, rad*1.05, 0, Math.PI*2); nameCtx.fill();
  }
}

/* --- roses creation & interactions --- */
function makeRoseSVG(uid, size=86){
  const ns="http://www.w3.org/2000/svg";
  const svg=document.createElementNS(ns,'svg'); svg.setAttribute('viewBox','0 0 120 140'); svg.setAttribute('width',size); svg.setAttribute('height',Math.round(size*1.2));
  const defs=document.createElementNS(ns,'defs');
  defs.innerHTML = `<radialGradient id="rgA${uid}" cx="30%" cy="25%"><stop offset="0%" stop-color="#ffeff0"/><stop offset="45%" stop-color="#ff6b7f"/><stop offset="100%" stop-color="#b81428"/></radialGradient><radialGradient id="rgB${uid}" cx="50%" cy="44%"><stop offset="0%" stop-color="#fff2f3"/><stop offset="60%" stop-color="#ff89a0"/><stop offset="100%" stop-color="#a60f1b"/></radialGradient>`;
  svg.appendChild(defs);
  const g=document.createElementNS(ns,'g'); g.setAttribute('transform','translate(60,60)');
  const big=document.createElementNS(ns,'path'); big.setAttribute('d','M0 -32 C12 -48 36 -46 38 -28 C38 -14 22 6 6 6 C-10 6 -28 -6 -26 -22 C-24 -36 -12 -28 0 -32Z'); big.setAttribute('fill','url(#rgA'+uid+')'); big.setAttribute('stroke','#6a0f18'); big.setAttribute('stroke-width','0.9'); g.appendChild(big);
  const p1=document.createElementNS(ns,'path'); p1.setAttribute('d','M0 -22 C8 -34 22 -32 24 -20 C24 -8 14 6 2 6 C-10 6 -20 -6 -18 -16 C-16 -26 -8 -20 0 -22Z'); p1.setAttribute('fill','url(#rgB'+uid+')'); p1.setAttribute('stroke','#5a0c14'); p1.setAttribute('stroke-width','0.7'); p1.setAttribute('transform','rotate(18)'); g.appendChild(p1);
  const p2=p1.cloneNode(true); p2.setAttribute('transform','rotate(-18)'); g.appendChild(p2);
  const inner=document.createElementNS(ns,'path'); inner.setAttribute('d','M0 -14 C6 -24 16 -22 18 -14 C18 -8 12 0 4 0 C-4 0 -10 -6 -8 -12 C-6 -16 -2 -12 0 -14Z'); inner.setAttribute('fill','#7a0810'); inner.setAttribute('stroke','#ffb2b8'); inner.setAttribute('stroke-width','0.5'); g.appendChild(inner);
  const center=document.createElementNS(ns,'circle'); center.setAttribute('r','4'); center.setAttribute('cy','4'); center.setAttribute('fill','#ffd6e0'); center.setAttribute('opacity','0.95'); g.appendChild(center);
  svg.appendChild(g); return svg;
}
function makeStemSVG(length=92){ const ns="http://www.w3.org/2000/svg"; const svg=document.createElementNS(ns,'svg'); svg.setAttribute('viewBox','0 0 20 120'); svg.setAttribute('width','12'); svg.setAttribute('height',String(length)); svg.style.position='absolute'; svg.style.left='50%'; svg.style.bottom='-10px'; svg.style.transform='translateX(-50%)'; const defs=document.createElementNS(ns,'defs'); defs.innerHTML = `<linearGradient id="gSt"><stop offset="0" stop-color="#4cbf55"/><stop offset="1" stop-color="#0c5a24"/></linearGradient>`; svg.appendChild(defs); const path=document.createElementNS(ns,'path'); path.setAttribute('d',`M10 6 C12 ${Math.round(length*0.33)} 8 ${Math.round(length*0.9)} 10 ${length-8}`); path.setAttribute('stroke','url(#gSt)'); path.setAttribute('stroke-width','4'); path.setAttribute('stroke-linecap','round'); path.setAttribute('fill','none'); svg.appendChild(path); return svg; }

function spawnFlower({leftPct, topPct, angle=0, scale=1, uid}){
  const wrap=document.createElement('div'); wrap.className='flower';
  const adjustedScale = scale * (isMobile ? 0.84 : 1);
  wrap.style.left = leftPct + '%'; wrap.style.top = topPct + '%';
  wrap.style.transform = `translate(-50%,-50%) rotate(${angle}deg) scale(${adjustedScale})`;
  wrap.setAttribute('role','button'); wrap.setAttribute('aria-label','Rosa');
  wrap.appendChild(makeStemSVG(Math.round(86*adjustedScale)));
  const rose = makeRoseSVG(uid, Math.round(86*adjustedScale));
  rose.style.position='absolute'; rose.style.left='50%'; rose.style.bottom='6px'; rose.style.transform='translateX(-50%)';
  wrap.appendChild(rose);
  wrap.addEventListener('click', (e)=>{ e.stopPropagation(); showTooltip(wrap); showSparklesAround(wrap); });
  document.getElementById('flowers').appendChild(wrap);
  return wrap;
}

function heartPoint(t){ return { x: 16*Math.pow(Math.sin(t),3), y: 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t) }; }

function createHeartLayout(count=30){
  const cont=document.getElementById('flowers'); cont.innerHTML=''; let uid=0;
  const main = Math.max(18, Math.round(isMobile ? count * 0.75 : count));
  for(let i=0;i<main;i++){ const t = -Math.PI + (i/(main-1))*(2*Math.PI); const p = heartPoint(t);
    const left = 50 + (p.x/32)*60 + (Math.random()*6 - 3);
    const top  = 44 + (-p.y/28)*50 + (Math.random()*4 - 2);
    spawnFlower({leftPct:left, topPct:top, angle:(Math.random()*12 - 6), scale:isMobile ? 0.74 + Math.random()*0.18 : 0.82 + Math.random()*0.28, uid:++uid});
  }
  for(let i=0;i<Math.max(6, Math.round(main/5));i++){ const t=Math.random()*Math.PI*2; const p=heartPoint(t);
    const left = 50 + (p.x/32)*60 + (Math.random()*8 - 4);
    const top  = 44 + (-p.y/28)*50 + (Math.random()*6 - 3);
    spawnFlower({leftPct:left, topPct:top, angle:(Math.random()*20 - 10), scale:isMobile ? 0.52 + Math.random()*0.36 : 0.58 + Math.random()*0.34, uid:++uid});
  }
}

/* tooltip & sparkles */
const phrases=["Eres la razón de mi sonrisa ❤️","Contigo cada día brilla más ✨","Eres mi calma, mi risa, mi cobijo 💖","A tu lado aprendí a querer sin condiciones 💘","De Alexander para ti, reina; te amo con todo mi corazón"];
function showTooltip(f){ const ex=f.querySelector('.tooltip'); if(ex) ex.remove(); const tip=document.createElement('div'); tip.className='tooltip'; tip.textContent=phrases[Math.floor(Math.random()*phrases.length)]; f.appendChild(tip); setTimeout(()=> tip.remove(), 3400); }
function showSparklesAround(el){ const rect=el.getBoundingClientRect(); const cx=rect.left+rect.width/2; const cy=rect.top+rect.height/2; const count=isMobile?10:18; for(let i=0;i<count;i++){ const sp=document.createElement('div'); sp.className='sparkle'; sp.innerText='✦'; document.getElementById('starContainer').appendChild(sp); sp.style.left=cx+'px'; sp.style.top=cy+'px'; sp.style.fontSize=(10+Math.random()*12)*(isMobile?0.7:1)+'px'; const ang=Math.random()*Math.PI*2; const dist=20 + Math.random()*(isMobile?80:120); const dx=Math.cos(ang)*dist; const dy=Math.sin(ang)*dist; sp.animate([{transform:'translate(0,0) scale(.6)',opacity:1},{transform:`translate(${dx}px,${dy}px) scale(1.05)`,opacity:0}],{duration:650+Math.random()*700,easing:'cubic-bezier(.2,.8,.2,1)'}); setTimeout(()=> sp.remove(), 900 + Math.random()*700); } }

/* outside clicks -> emojis */
const emojis=['😍','😘','🥰','💖','😻'];
document.getElementById('stage').addEventListener('click', (e)=>{ if(e.target.closest('.controls')) return; if(e.target.closest('.flower')) return; spawnEmoji(e.clientX, e.clientY); });
function spawnEmoji(x,y){ const el=document.createElement('div'); el.className='emoji'; el.innerText=emojis[Math.floor(Math.random()*emojis.length)]; el.style.left=(x-16)+'px'; el.style.top=(y-16)+'px'; el.style.fontSize=(isMobile?20:30)+'px'; document.body.appendChild(el); setTimeout(()=> el.remove(),1600); }

/* surprise */
const btnSorp = document.getElementById('btnSorpresa');
const btnReload = document.getElementById('btnReload');
const modalBackdrop = document.getElementById('modalBackdrop');
document.getElementById('closeModal').addEventListener('click', ()=> modalBackdrop.classList.remove('show'));
btnReload.addEventListener('click', ()=> location.reload());

btnSorp.addEventListener('click', () => {
  bigStarState.active = true;
  bigStarState.start = performance.now();
  const sc = getStarCenter(); // now center of screen
  setTimeout(()=> spawnExplodingParticles(sc.x, sc.y, isMobile ? 70 : 120), bigStarState.duration * 0.38);
  setTimeout(()=> modalBackdrop.classList.add('show'), bigStarState.duration + 260);
});

function spawnExplodingParticles(cx, cy, count=80){
  const particles=[];
  const cap = Math.min(count, 220);
  for(let i=0;i<cap;i++){
    const el=document.createElement('div'); el.className='sparkle'; el.innerText=['✦','✧','✺','✶'][Math.floor(Math.random()*4)];
    const size = (6 + Math.random()*12) * (isMobile ? 0.7 : 1);
    el.style.fontSize = size + 'px'; el.style.left = cx + 'px'; el.style.top = cy + 'px'; starContainer.appendChild(el);
    const angle=Math.random()*Math.PI*2; const speed=1.8 + Math.random()*6.5;
    const vx=Math.cos(angle)*speed; const vy=Math.sin(angle)*speed*0.6 - (0.8 + Math.random()*2.0);
    particles.push({el,x:cx,y:cy,vx,vy,rot:Math.random()*360,vr:(Math.random()*8 - 4),life:200 + Math.random()*160});
  }
  let lastT = performance.now();
  function step(t){
    const dt = (t - lastT) / 16.666; lastT = t;
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vy += 0.18 * dt;
      p.vx *= 0.995; p.vy *= 0.998;
      p.x += p.vx * dt * 2.2; p.y += p.vy * dt * 2.2;
      p.rot += p.vr * dt; p.life -= 8 * dt;
      const alpha = Math.max(0, p.life / 300);
      p.el.style.transform = `translate(${Math.round(p.x)}px, ${Math.round(p.y)}px) rotate(${p.rot}deg) translate(-50%,-50%)`;
      p.el.style.opacity = String(alpha);
      if(alpha <= 0.03 || p.y > window.innerHeight + 80){ p.el.remove(); particles.splice(i,1); }
    }
    if(particles.length > 0) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* small burst helper */
function spawnSparkleBurst(cx,cy,count=36){ for(let i=0;i<count;i++){ const sp=document.createElement('div'); sp.className='sparkle'; sp.innerText=['✦','✧','✺'][Math.floor(Math.random()*3)]; starContainer.appendChild(sp); sp.style.left = cx + 'px'; sp.style.top = cy + 'px'; sp.style.fontSize=(8 + Math.random()*12)*(isMobile?0.7:1)+'px'; const ang=Math.random()*Math.PI*2; const dist=40 + Math.random()*(isMobile?window.innerWidth/3:window.innerWidth/2); const dx=Math.cos(ang)*dist; const dy=Math.sin(ang)*dist; sp.animate([{transform:'translate(0,0) scale(.6)', opacity:1},{transform:`translate(${dx}px,${dy}px) scale(1.05)`, opacity:0}],{duration:700 + Math.random()*900,easing:'cubic-bezier(.2,.8,.2,1)'}); setTimeout(()=> sp.remove(), 900 + Math.random()*1000); } }

/* init */
function initAll(){
  fitCanvases();
  createHeartLayout(30);
  createNameStars(currentName);
  const nc = getNameCenter();
  spawnSparkleBurst(nc.x, nc.y, isMobile ? 12 : 22); // burst at name (subido)
  last = performance.now();
  if(rafId) cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(render);
  setTimeout(()=> { if(document.getElementById('flowers').children.length < 6) createHeartLayout(30); }, 420);
}

window.addEventListener('resize', ()=> { clearTimeout(window._rTO); window._rTO = setTimeout(()=> { fitCanvases(); createHeartLayout(30); createNameStars(currentName); }, 140); });

document.addEventListener('DOMContentLoaded', ()=> { try{ initAll(); } catch(e){ console.error(e); alert('Error al iniciar, mira consola.'); } });
</script>
</body>
</html>
